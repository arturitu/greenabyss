const urlParam = require('urlparam');
const isDesktop = require('utils/devices/isDesktop');
const isMagicWindow = require('utils/devices/isMagicWindow');

var settings = {};

//this is primarily a VR project, so VR is default
var defaultValues = {
	drawDistance: 32,
	devicePixelRatio: Math.min(3.5, window.devicePixelRatio)
};

var desktopValues = {
};

var magicWindowValues = {
};

//util methods and shorthand
function either(a, b) {
	return (a !== undefined) ? a : b;
}

function urlHasParam(key) {
	return urlParam(key) !== undefined;
}

// this pattern is good because isDesktop() does not resolve to the correct answer until well into the experience, so we query isDesktop just in time
// try to avoid hammering settings on every tick: cache them sensibly.
// Also, in this pattern we allow the user to override any setting with a url param

Object.keys(defaultValues).forEach(function(key) {
	var value = defaultValues[key];
	var valueDesktop = either(desktopValues[key], defaultValues[key]);
	var valueMagicWindow = either(magicWindowValues[key], defaultValues[key]);
	Object.defineProperty(settings, key, {
		get: function() {
			if(urlHasParam(key)) {
				return urlParam(key);
			}
			if(isDesktop()) {
				return valueDesktop;
			} else if(isMagicWindow()) {
				return valueMagicWindow;
			} else {
				return value;
			}
		}
	});
});

module.exports = settings;
